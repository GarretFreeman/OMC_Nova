<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OMC — Calcul des coûts</title>
  <link rel="icon" href="assets/logo_omc.png" type="image/png">
  <link rel="apple-touch-icon" href="assets/Logo-omc.png">
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --panel-2:#0b1223; --text:#e5e7eb; --muted:#9ca3af;
      --ring:#1f2937; --primary:#38bdf8; --radius:16px; --shadow:0 16px 38px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text); font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Noto Sans","Helvetica Neue",Arial}

    .wrap{max-width:1200px; margin:32px auto; padding:0 16px}

    /* ======= Top identique à l'accueil mais 2x plus petit ======= */
    .top{
      text-align:center; margin-bottom:18px;
    }
    .brand{
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px;
    }
    .brand img{
      height:72px;   /* 144 -> 72 */
      width:288px;   /* 576 -> 288 */
      object-fit:contain; background:#071423; padding:6px; border-radius:16px;
    }
    .brand strong{ font-size:18px; font-weight:800; letter-spacing:.3px }

    .backbar{display:flex; justify-content:center; margin:8px 0 10px}
    .back{appearance:none; border:1px solid var(--ring); background:#0b1223; color:var(--text);
      text-decoration:none; padding:8px 12px; border-radius:12px}
    .back:hover{background:#0e1a2e; border-color:#20314f}

    /* ======= Layout 3 colonnes ======= */
    .layout{display:grid; grid-template-columns: 240px 1fr 360px; gap:16px}
    @media (max-width:1080px){ .layout{grid-template-columns:220px 1fr} .aside{grid-column:1 / -1; position:static} }
    @media (max-width:780px){ .layout{grid-template-columns:1fr} }

    .panel{background:linear-gradient(180deg,var(--panel),var(--panel-2)); border:1px solid var(--ring); border-radius:var(--radius); box-shadow:var(--shadow)}
    .panel-body{padding:14px}

    /* ======= Sidebar gauche : recherche + catégories ======= */
    .sidebar{position:sticky; top:16px}
    .search{display:flex; gap:8px; margin-bottom:12px}
    .input{flex:1; padding:10px 12px; border-radius:12px; border:1px solid var(--ring); background:#0b1223; color:#fff}

    .cats{display:flex; flex-direction:column; gap:8px}
    .cat{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      padding:10px 12px; border:1px solid var(--ring); border-radius:12px;
      background:#0b1223; cursor:pointer; color:#ffffff;   /* texTE blanc */
      transition: background .15s ease, border-color .15s ease;
    }
    .cat:hover{ background:#102039; border-color:#1b3a63 } /* survol change de couleur */
    .cat[aria-current="true"]{ background:linear-gradient(180deg,#0f2746,#0c1d35); border-color:#1b3a63 }
    .count{font-size:12px; color:#e5e7eb; border:1px solid var(--ring); padding:2px 8px; border-radius:999px}

    /* ======= Centre : cartes ======= */
    .toolbar{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px}
    .hint{color:var(--muted); font-size:13px}
    .grid{display:grid; gap:12px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); padding:8px}
    .card{background:#0b1223; border:1px solid var(--ring); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:10px; transition:transform .08s ease, border-color .12s ease, background .12s ease}
    .card:hover{ transform:translateY(-2px); border-color:#1e2a44; background:#0c1529 }
    .name{font-weight:800; line-height:1.25}
    .meta{color:#9ca3af; font-size:12px}
    .price{font-weight:800; font-size:18px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .qty{display:inline-flex; align-items:center; gap:6px}
    .step{width:36px; height:36px; display:grid; place-items:center; border-radius:10px; border:1px solid var(--ring); background:#0b1223; color:#fff; font-size:18px; cursor:pointer}
    .qty input{width:64px; padding:8px 10px; border-radius:10px; border:1px solid var(--ring); background:#0b1223; color:#fff; text-align:center}
    .add{padding:10px 12px; border-radius:12px; border:1px solid #1b3a63; background:#0f2746; color:#e5e7eb; font-weight:700}
    .add:hover{background:#123155}

    /* ======= Droite : Récap (sans TVA, sans copier/export) ======= */
    .aside{position:sticky; top:16px; height:fit-content}
    .aside .panel-body{display:flex; flex-direction:column; gap:12px}

    .summary-wrap{border:1px solid var(--ring); border-radius:12px; overflow:hidden}
    table.summary{width:100%; border-collapse:collapse; font-size:14px; background:#0b1223}
    .summary thead th{background:#0c1529; color:#cbd5e1; text-align:left; padding:8px 10px; border-bottom:1px solid var(--ring)}
    .summary tbody td{padding:8px 10px; border-bottom:1px dashed #1e2a44; vertical-align:top}
    .summary tbody tr:last-child td{border-bottom:none}
    .summary .col-qty{width:90px; text-align:center}
    .summary .col-line{width:120px; text-align:right; font-variant-numeric:tabular-nums}
    .summary .ctrls{display:inline-flex; gap:6px}
    .summary .mini{width:26px; height:26px; border-radius:7px; border:1px solid var(--ring); background:#0b1223; color:#fff; display:grid; place-items:center; cursor:pointer}

    .grand{font-size:26px; font-weight:900; text-align:right}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- TOP allégé, identique à l'accueil mais 2x plus petit -->
    <div class="top">
      <div class="brand">
        <img src="assets/Logo-omc.png" alt="OMC">
        <strong>Ocean Medical Center — Intranet</strong>
      </div>
      <div class="backbar">
        <a class="back" href="index.html">← Accueil</a>
      </div>
    </div>

    <div class="layout">
      <!-- COLONNE GAUCHE : Recherche + catégories -->
      <aside class="sidebar panel" aria-label="Filtres">
        <div class="panel-body">
          <div class="search" role="search">
            <input id="q" class="input" type="search" placeholder="Rechercher (nom, code)…" aria-label="Rechercher">
          </div>

          <div class="cats" id="cats" role="tablist" aria-label="Catégories">
            <!-- Catégories injectées en JS -->
          </div>
        </div>
      </aside>

      <!-- COLONNE CENTRE : Cartes -->
      <main class="panel" aria-live="polite">
        <div class="panel-body">
          <div class="toolbar">
            <div class="hint" id="hintCount">—</div>
            <div class="hint">Astuce : “Ajouter” ou utilisez + / −</div>
          </div>
          <div id="grid" class="grid"></div>
        </div>
      </main>

      <!-- COLONNE DROITE : Récap (Total uniquement) -->
      <aside class="aside panel" aria-label="Récapitulatif">
        <div class="panel-body">
          <div class="summary-wrap">
            <table class="summary" aria-describedby="summaryCaption">
              <caption id="summaryCaption" style="position:absolute;left:-9999px">Récapitulatif des éléments sélectionnés</caption>
              <thead>
                <tr>
                  <th>Désignation</th>
                  <th class="col-qty">Qté</th>
                  <th class="col-line">Total</th>
                </tr>
              </thead>
              <tbody id="summaryBody">
                <tr class="empty-row"><td colspan="3" style="color:#9ca3af; padding:10px">— Aucun soin sélectionné —</td></tr>
              </tbody>
            </table>
          </div>

          <div class="grand" id="grand">$0</div>
        </div>
      </aside>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    /* =========================
       Données
       ========================= */
    const CATALOG = [
      { id:'CONS_TRAVAIL',  name:'Certificat aptitude Travail',      priceUSD:450,  category:'Consultation' },
      { id:'CONS_PPA',      name:'Certificat aptitude PPA',          priceUSD:6500, category:'Consultation' },
      { id:'CONS_PSY',      name:'Psychologue',                      priceUSD:850,  category:'Consultation' },
      { id:'CONS_KINE',     name:'Kinésithérapeute',                 priceUSD:650,  category:'Consultation' },
      { id:'CONS_MED',      name:'Médecine générale',                priceUSD:550,  category:'Consultation' },
      { id:'CONS_GYNECO',   name:'Gynécologie',                      priceUSD:800,  category:'Consultation' },
      { id:'CONS_INFECTIO', name:'Infectiologue et laboratoire',     priceUSD:350,  category:'Consultation' },

      { id:'AMBUL_LOCAL',   name:'Transport ambulance locale',       priceUSD:200,  category:'Transport' },
      { id:'TRANS_BAT',     name:'Intervention maritime',            priceUSD:1900, category:'Transport' },
      { id:'TRANS_HEL',     name:'Intervention Hélicoptère',         priceUSD:2900, category:'Transport' },

      { id:'HOP_SOIN',      name:'Soins',                            priceUSD:450,  category:'Soins Hôpital' },
      { id:'HOP_REA',       name:'Réanimation',                      priceUSD:800,  category:'Soins Hôpital' },
      { id:'HOP_CHIR',      name:'Chirurgie',                        priceUSD:3200, category:'Soins Hôpital' },
      { id:'HOP_SUTURE',    name:'Points de suture',                 priceUSD:500,  category:'Soins Hôpital' },
      { id:'HOP_ATTELLE',   name:"Fourniture et pose d'une attelle", priceUSD:950,  category:'Soins Hôpital' },
      { id:'HOP_PLATRE',    name:"Fourniture et pose d'un plâtre",   priceUSD:1100, category:'Soins Hôpital' },
      { id:'HOP_PROT',      name:"Fourniture et pose d'une prothèse",priceUSD:6500, category:'Soins Hôpital' },

      { id:'IMG_RADIO',     name:'Radio de contrôle',                priceUSD:480,  category:'Imagerie' },
      { id:'IMG_SCAN',      name:'Scanner de contrôle',              priceUSD:412,  category:'Imagerie' },
      { id:'IMG_IRM',       name:'IRM',                              priceUSD:1119, category:'Imagerie' },
      { id:'IMG_ECHO',      name:'Échographie',                      priceUSD:733,  category:'Imagerie' },

      { id:'SITE_SOIN',     name:'Soins',                            priceUSD:450,  category:'Soins sur site' },
      { id:'SITE_REA',      name:'Réanimation',                      priceUSD:800,  category:'Soins sur site' },
    ];

    /* =========================
       Sélecteurs
       ========================= */
    const els = {
      cats: document.getElementById('cats'),
      grid: document.getElementById('grid'),
      hintCount: document.getElementById('hintCount'),
      q: document.getElementById('q'),

      summaryBody: document.getElementById('summaryBody'),
      grand: document.getElementById('grand')
    };

    /* =========================
       État
       ========================= */
    const fmtUSD = (n) => new Intl.NumberFormat('en-US', { style:'currency', currency:'USD' }).format(n);
    const categories = [...new Set(CATALOG.map(x => x.category))];
    const counts = Object.fromEntries(categories.map(c => [c, CATALOG.filter(x=>x.category===c).length]));
    const state = new Map();        // id -> qty
    let activeCategory = categories[0];
    let query = '';

    /* =========================
       Rendu Catégories
       ========================= */
    function renderCats(){
      els.cats.innerHTML = '';
      for(const c of categories){
        const btn = document.createElement('button');
        btn.type='button';
        btn.className='cat';
        btn.setAttribute('role','tab');
        btn.setAttribute('aria-current', String(c===activeCategory));
        btn.innerHTML = `<span>${c}</span><span class="count">${counts[c]}</span>`;
        btn.onclick = () => { activeCategory = c; renderGrid(); updateSummary(); };
        els.cats.appendChild(btn);
      }
    }

    /* =========================
       Filtre
       ========================= */
    function filterItems(){
      return CATALOG.filter(x =>
        x.category === activeCategory &&
        (query==='' ||
         x.name.toLowerCase().includes(query) ||
         x.id.toLowerCase().includes(query))
      );
    }

    /* =========================
       Rendu Grid
       ========================= */
    function renderGrid(){
      const items = filterItems();
      els.hintCount.textContent = `${items.length} élément(s) · Catégorie : ${activeCategory}`;
      els.grid.innerHTML = '';

      for(const item of items){
        const card = document.createElement('div');
        card.className = 'card';

        const head = document.createElement('div');
        head.innerHTML = `<div class="name">${item.name}</div>
                          <div class="meta">${item.id} · ${item.category}</div>`;

        const price = document.createElement('div');
        price.className = 'price';
        price.textContent = fmtUSD(item.priceUSD);

        const controls = document.createElement('div'); controls.className = 'row';
        const qty = document.createElement('div'); qty.className = 'qty';
        const minus = document.createElement('button'); minus.className='step'; minus.textContent='−';
        const input = document.createElement('input'); input.type='number'; input.min='0'; input.step='1'; input.value = state.get(item.id) ?? 0;
        const plus  = document.createElement('button'); plus.className='step'; plus.textContent='+';
        minus.onclick = () => { setQty(item.id, Math.max(0,(state.get(item.id)||0)-1)); input.value = state.get(item.id)||0; };
        plus.onclick  = () => { setQty(item.id, (state.get(item.id)||0)+1);         input.value = state.get(item.id)||0; };
        input.oninput = () => { const v=Math.max(0, parseInt(input.value||'0',10)); setQty(item.id, v); input.value=v; };
        qty.append(minus,input,plus);

        const add = document.createElement('button'); add.className='add'; add.textContent='Ajouter';
        add.onclick = () => { setQty(item.id, (state.get(item.id)||0)+1); input.value = state.get(item.id)||0; };

        controls.append(price, qty);
        card.append(head, controls, add);
        els.grid.appendChild(card);
      }
    }

    /* =========================
       Calculs & Récap (TOTAL seulement)
       ========================= */
    function compute(){
      const rows = [];
      let subtotal = 0;
      for(const item of CATALOG){
        const q = state.get(item.id)||0; if(!q) continue;
        const line = item.priceUSD * q; subtotal += line;
        rows.push({ id:item.id, name:item.name, qty:q, line });
      }
      return { rows, total: subtotal };
    }

    function updateSummary(){
      const {rows, total} = compute();
      els.summaryBody.innerHTML = '';
      if(rows.length === 0){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td colspan="3" style="color:#9ca3af; padding:10px">— Aucun soin sélectionné —</td>`;
        els.summaryBody.appendChild(tr);
      } else {
        for(const r of rows){
          const tr = document.createElement('tr');
          const cName = document.createElement('td'); cName.textContent = r.name;
          const cQty  = document.createElement('td'); cQty.className='col-qty';
          const ctrls = document.createElement('div'); ctrls.className='ctrls';
          const m = document.createElement('button'); m.className='mini'; m.textContent='−';
          const n = document.createElement('span');   n.textContent = r.qty;
          const p = document.createElement('button'); p.className='mini'; p.textContent='+';
          m.onclick = () => { setQty(r.id, Math.max(0,(state.get(r.id)||0)-1)); };
          p.onclick = () => { setQty(r.id, (state.get(r.id)||0)+1); };
          ctrls.append(m,n,p); cQty.appendChild(ctrls);

          const cLine = document.createElement('td'); cLine.className='col-line'; cLine.textContent = fmtUSD(r.line);
          tr.append(cName,cQty,cLine);
          els.summaryBody.appendChild(tr);
        }
      }
      els.grand.textContent = fmtUSD(total);
    }

    function setQty(id, qty){
      if(qty <= 0) state.delete(id); else state.set(id, qty);
      updateSummary();
    }

    /* =========================
       Recherche
       ========================= */
    els.q.addEventListener('input', () => {
      query = els.q.value.trim().toLowerCase();
      renderGrid();
      updateSummary();
    });

    /* =========================
       Init
       ========================= */
    renderCats();
    renderGrid();
    updateSummary();
  });
  </script>
</body>
</html>
