<!doctype html>
els.list.appendChild(row);
});
}
function compute(){
let lines = []; let subtotal = 0;
for(const item of CATALOG){
const q = state.get(item.id)||0; if(!q) continue;
const unit = item.priceUSD; const line = unit * q; subtotal += line;
lines.push(`• ${item.name} × ${q} — ${fmtUSD(line)} (${fmtUSD(unit)}/u)`);
}
const taxEnabled = els.taxEnable.checked;
const taxRate = Math.max(0, Number(els.taxRate.value||0));
const taxValue = taxEnabled ? (subtotal * taxRate/100) : 0;
const total = subtotal + taxValue;
return { lines, subtotal, taxEnabled, taxRate, taxValue, total };
}
function updateSummary(){
const {lines, subtotal, total} = compute();
els.summary.textContent = lines.length ? lines.join('
') : '— Aucun soin sélectionné —';
els.subtotal.textContent = fmtUSD(subtotal);
els.total.textContent = fmtUSD(total);
els.taxRate.disabled = !els.taxEnable.checked;
els.taxRate.style.opacity = els.taxEnable.checked ? 1 : .6;
}


els.tabs.addEventListener('click', (e) => {
const btn = e.target.closest('.tab'); if (!btn) return;
activeCategory = btn.dataset.cat; syncTabs(); renderList(); updateSummary();
});
els.taxEnable.addEventListener('change', updateSummary);
els.taxRate.addEventListener('input', updateSummary);
els.reset.addEventListener('click', ()=>{ state.clear(); updateSummary(); renderList(); });


// Init + Tests opt.
syncTabs(); renderList(); updateSummary();
if(location.search.includes('test')){
try{
state.clear(); state.set('CERT_TRAVAIL',2); state.set('HOP_PLATRE',1); // 900 + 950 = 1850
const r1 = compute(); console.assert(r1.subtotal===1850, 'Sous-total attendu 1850, obtenu: '+r1.subtotal);
els.taxEnable.checked = true; els.taxRate.value = 10; const r2 = compute(); console.assert(r2.total===2035, 'Total attendu 2035, obtenu: '+r2.total);
console.log('%c[Tests calc] OK','color:#22c55e');
}catch(e){ console.error('[Tests calc] FAIL', e); }
}
});
</script>
</body>
</html>
